import process


actor main(env):
    def on_stderr(data):
        print("Received output on stderr:", data)
        env.exit(0)

    def on_stdout(data):
        print("Received output on stdout:", data.decode())
        if data == b"HELLO\n":
            print("All good, exiting..")
            await async env.exit(0)
        else:
            print("Unexpected output, blargh")
            await async env.exit(1)

    def on_exit(exit_code, term_signal):
        print("Process exited with code: ", exit_code, " terminated with signal:", term_signal)

    def test():
        print("Starting process..")
        pa = process.ProcessAuth(env.auth)
        p = process.Process(pa, ["echo", "HELLO"], on_stdout, on_stderr, on_exit)

    def ex():
        print("Test timeout, exiting with error..")
        env.exit(1)

    test()
    after 1: ex()
