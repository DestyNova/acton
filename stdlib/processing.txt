Processing of an incoming NETCONF RPC


IP + TCP in OS kernel
  |
  | stream of bytes, delivered in chunks by OS recv() syscall 
  |
  V
SSH impl 
     processes an encrypted stream consisting of ssh packets.
     After key exchange, the stream is decrypted and then deframed
     and demultiplexed, producing a number of ssh packet streams,
     one per open ssh channel.

  SSH decrypt + deframing + trimming of frames + demultiplexing
  
  |                             |   |   |  ...  |
  | decrypted ssh packets       |   |   |  ...  |
  |                             |   |   |  ...  |
  V                             V   V   V       V

NETCONF subsystem
  processes stream of channel data chunks
  produces sequence of NETCONF frames

  NETCONF deframing + trimming of frames

  |
  | utf-8 encoded XML documents representing NETCONF RPC
  |
  V
  
  utf-8 decoding (bytes -> string)

  |
  | XML-encoded NETCONF RPC:s           
  |                                     
  V                                     

  XML parsing                           
                                        
  |                             
  | XML trees                   
  |                             
  V                             
                                
  XML Operations -> XML replies
  
                          |
                          |  XML trees
			  |
			  V

			  XML printing

			  |
			  | XML-encoded NETCONF RPC-REPLIES
			  |
			  V
 			  
                          utf-8 encoding

                          |
                          | utf-8 encoded XML for NETCONF RPC-REPLIES
                          |
			  V

                          NETCONF framing (adding framing headers & tails
			  
                          |                  |   |  . . .  |
                          | NETCONF frames   |   |  . . .  |
                          |                  |   |  . . .  |
			  V                  V   V         V

                        SSH system

                          multiplexing channels into single SSH pipe
			  adding headers & tails to data chunks

                          |
                          |  plaintext SSH packets
                          |
			  V

                          SSH encryption
			  
                          |
                          |  stream of bytes (encrypted multiplexed SSH packets)
                          |
			  V

                        OS send() syscall
			IP & TCP system in OS			
